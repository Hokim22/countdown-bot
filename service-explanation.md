# カウントダウンbotシステム - サービス詳細説明

## 📊 システム構成図

```
┌──────────────────┐    ┌──────────────────┐    ┌──────────────────┐
│   EventBridge    │    │      Lambda      │    │    DynamoDB      │
│                  │    │                  │    │                  │
│  ⏰ 1時間に1回   │───▶│  countdown-bot   │───▶│ exam-countdown   │
│  rate(1 hour)    │    │                  │    │                  │
│                  │    │ ・カウントダウン │    │ ・試験データ     │
└──────────────────┘    │ ・キャラ選択     │    │ ・Webhook URL    │
                        │ ・メッセージ生成 │    │ ・キャラ設定     │
                        └─────────┬────────┘    └──────────────────┘
                                  │
                        ┌─────────▼────────┐
                        │     Bedrock      │
                        │                  │
                        │ Claude 3 Haiku   │
                        │ AI文章生成       │
                        │ キャラ別プロンプト│
                        └─────────┬────────┘
                                  │
                        ┌─────────▼────────┐
                        │      Slack       │
                        │                  │
                        │  Webhook API     │
                        │  メッセージ投稿  │
                        │                  │
                        └──────────────────┘
```

## 🔧 使用サービスと役割

### 1. Amazon EventBridge
**サービス名**: Amazon EventBridge（旧CloudWatch Events）

**役割**: スケジューラー・トリガー
- ⏰ **定期実行**: `rate(1 hour)` で1時間に1回Lambda関数を起動
- 🎯 **イベント駆動**: 指定した時間になると自動的にLambdaを呼び出す
- 📅 **cron機能**: 複雑なスケジュール設定も可能

**なぜ使用するか**:
- サーバーレスでスケジュール実行が可能
- 高い信頼性と正確性
- 従量課金で低コスト

---

### 2. AWS Lambda
**サービス名**: AWS Lambda

**役割**: メイン処理エンジン
- 🧠 **ビジネスロジック**: カウントダウン計算、キャラクター選択
- 🔄 **データ処理**: DynamoDBからの読み取り、Bedrockへの呼び出し
- 📤 **通知処理**: Slackへのメッセージ投稿

**実装内容**:
```javascript
// 主要な処理フロー
1. DynamoDBから試験データ取得
2. 残り日数計算
3. キャラクターランダム選択
4. Bedrockでメッセージ生成
5. Slackに投稿
```

**なぜ使用するか**:
- サーバー管理不要
- 実行時間分のみ課金
- 自動スケーリング

---

### 3. Amazon DynamoDB
**サービス名**: Amazon DynamoDB

**役割**: 設定データベース
- 💾 **データ保存**: 試験情報の永続化
- 🔍 **高速読み取り**: ミリ秒レベルのアクセス
- 📊 **構造化データ**: JSON形式での柔軟なデータ管理

**保存データ例**:
```json
{
  "examId": "exam001",
  "examName": "社内勉強会での発表",
  "targetDate": "2025-10-14",
  "slackWebhookUrl": "https://hooks.slack.com/..."
}
```

**なぜ使用するか**:
- NoSQLで柔軟なスキーマ
- サーバーレスで管理不要
- 低コストで高性能

---

### 4. Amazon Bedrock
**サービス名**: Amazon Bedrock

**役割**: AI文章生成エンジン
- 🤖 **AI モデル**: Claude 3 Haiku を使用
- 📝 **文章生成**: キャラクター別の個性的なメッセージ作成
- 🎭 **プロンプト処理**: 詳細なキャラクター設定に基づく生成

**生成プロセス**:
```
キャラクター選択 → 専用プロンプト → Claude 3 Haiku → 個性的メッセージ
```

**なぜ使用するか**:
- 高品質な日本語生成
- キャラクター別の個性表現
- 従量課金で低コスト

---

### 5. Slack Webhook API
**サービス名**: Slack（外部サービス）

**役割**: メッセージ配信プラットフォーム
- 📱 **メッセージ投稿**: 指定チャンネルへの自動投稿
- 🔗 **Webhook連携**: HTTPSでの簡単な連携
- 👤 **Bot設定**: カスタムユーザー名とアイコン

**投稿内容**:
```
📚 社内勉強会での発表 まであと 3日
🎭 今日のキャラ: 毒舌系フリーター
はぁ？まだスライド作ってないの？あと3日しかないよ？💦
まずはアウトライン作成から始めなよ...
```

**なぜ使用するか**:
- 簡単なWebhook連携
- リアルタイム通知
- 無料で利用可能

---

## 🔄 サービス間連携フロー

### 1. EventBridge → Lambda
```
EventBridge: "1時間経ったよ！Lambda起動して！"
Lambda: "了解！処理開始します"
```

### 2. Lambda → DynamoDB
```
Lambda: "今日処理する試験データをください"
DynamoDB: "はい、これが登録されている試験一覧です"
```

### 3. Lambda → Bedrock
```
Lambda: "毒舌系フリーターで応援メッセージ作って"
Bedrock: "はぁ？まだ準備してないの？..."
```

### 4. Lambda → Slack
```
Lambda: "このメッセージをSlackに投稿して"
Slack: "投稿完了しました！"
```

## 💰 各サービスのコスト

| サービス | 月額コスト | 課金方式 |
|----------|------------|----------|
| EventBridge | ~$0.1 | ルール実行回数 |
| Lambda | ~$1-2 | 実行時間・メモリ |
| DynamoDB | ~$1 | 読み書き回数・ストレージ |
| Bedrock | ~$2-5 | AI生成トークン数 |
| Slack | 無料 | Webhook利用 |
| **合計** | **$4-8** | 従量課金 |

## 🎯 各サービスの選定理由

### サーバーレス統一
- 管理負荷ゼロ
- 自動スケーリング
- 高可用性

### 従量課金モデル
- 使った分だけ支払い
- 個人利用に最適
- 無駄なコストなし

### AWS エコシステム
- サービス間連携が簡単
- 統一された権限管理
- 一元的な監視・ログ